#!/usr/bin/python3
# ‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò ZADARMA DOWNLOADER
# ==============================
# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ API –∫–ª—é—á–µ–π –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ä–∞–±–æ—Ç—ã

import os
from dotenv import load_dotenv

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env —Ñ–∞–π–ª–∞
load_dotenv()

# üîë –ó–êDARMA API –ö–õ–Æ–ß–ò
# –ü–æ–ª—É—á–∏—Ç–µ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ: https://my.zadarma.com/api/
# –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å fallback –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
API_KEY = os.getenv("API_KEY")
API_SECRET = os.getenv("API_SECRET")

# üåç –†–ï–ñ–ò–ú –†–ê–ë–û–¢–´
# False = Production (–±–æ–µ–≤–æ–π —Ä–µ–∂–∏–º)
# True = Sandbox (—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)
SANDBOX_MODE = os.getenv("SANDBOX_MODE", "False").lower() == "true"

# üìÖ –ù–ê–°–¢–†–û–ô–ö–ò –í–†–ï–ú–ï–ù–ò
# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –Ω–∞–∑–∞–¥ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∑–∞–ø–∏—Å–µ–π
DAYS_BACK = int(os.getenv("DAYS_BACK", "1"))  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞

# üìÅ –ù–ê–°–¢–†–û–ô–ö–ò –ü–ê–ü–û–ö
# –ü–∞–ø–∫–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤ (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞)
DOWNLOAD_FOLDER = os.getenv("DOWNLOAD_FOLDER", "downloads")

# üéµ –ù–ê–°–¢–†–û–ô–ö–ò –§–ê–ô–õ–û–í
# –§–æ—Ä–º–∞—Ç –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ (–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å)
# –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: {call_id}, {date}, {time}, {sip}, {destination}, {duration}
FILENAME_TEMPLATE = os.getenv("FILENAME_TEMPLATE", "call_{call_id}_{date}_{time}_{sip}_to_{destination}.wav")

# üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –ù–ê–°–¢–†–û–ô–ö–ò
# –¢–∞–π–º–∞—É—Ç –¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
REQUEST_TIMEOUT = int(os.getenv("REQUEST_TIMEOUT", "60"))

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
MAX_DOWNLOAD_ATTEMPTS = int(os.getenv("MAX_DOWNLOAD_ATTEMPTS", "3"))

# üìä –ù–ê–°–¢–†–û–ô–ö–ò –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø
# –£—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –ª–æ–≥–æ–≤
# DEBUG = –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è
# INFO = –æ–±—ã—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
# WARNING = —Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏
LOG_LEVEL = os.getenv("LOG_LEVEL", "INFO")

# –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ª–∏ –ª–æ–≥–∏ –≤ —Ñ–∞–π–ª
SAVE_LOGS_TO_FILE = os.getenv("SAVE_LOGS_TO_FILE", "True").lower() == "true"
LOG_FILE = os.getenv("LOG_FILE", "logs/zadarma_downloader.log")
